<div>
    ${h.form(url('admin_settings_my_account_update'),method='put')}
        <div class="form">

             <div class="field">
               <div class="gravatar_box">
                   <div class="gravatar"><img alt="gravatar" src="${h.gravatar_url(c.user.email)}"/></div>
                    <p>
                    %if c.use_gravatar:
                    <strong>${_('Change your avatar at')} <a href="http://gravatar.com">gravatar.com</a></strong>
                    <br/>${_('Using')} ${c.user.email}
                    %else:
                    <strong>${_('Avatars are disabled')}</strong>
                    <br/>${c.user.email or _('Missing email, please update your user email address.')}
                    %endif
               </div>
             </div>
            <div class="field">
                <div class="label">
                    <label>${_('API key')}</label> ${c.user.api_key}
                </div>
            </div>
            <div class="field">
                <div class="label">
                    <label>${_('Current IP')}:</label> ${c.perm_user.ip_addr or "?"}
                </div>
            </div>
            <% readonly = None %>
            <% disabled = "" %>
            <div class="fields">
               %if c.extern_name:
                    <% readonly = "readonly" %>
                    <% disabled = " disabled" %>
                    <strong>${_('Your user is in an external Source of Record; some details cannot be managed here')}.</strong>
               %endif
                 <div class="field">
                    <div class="label">
                        <label for="username">${_('Username')}:</label>
                    </div>
                    <div class="input">
                      ${h.text('username',class_='medium%s' % disabled, readonly=readonly)}
                    </div>
                 </div>

                 <div class="field">
                    <div class="label">
                        <label for="new_password">${_('New password')}:</label>
                    </div>
                    <div class="input">
                        ${h.password('new_password',class_='medium%s' % disabled,autocomplete="off", readonly=readonly)}
                    </div>
                 </div>

                 <div class="field">
                    <div class="label">
                        <label for="password_confirmation">${_('New password confirmation')}:</label>
                    </div>
                    <div class="input">
                        ${h.password('password_confirmation',class_='medium%s' % disabled,autocomplete="off", readonly=readonly)}
                    </div>
                 </div>

                 <div class="field">
                    <div class="label">
                        <label for="name">${_('First Name')}:</label>
                    </div>
                    <div class="input">
                        ${h.text('firstname',class_="medium%s" % disabled,readonly=readonly)}
                    </div>
                 </div>

                 <div class="field">
                    <div class="label">
                        <label for="lastname">${_('Last Name')}:</label>
                    </div>
                    <div class="input">
                        ${h.text('lastname',class_="medium%s" % disabled,readonly=readonly)}
                    </div>
                 </div>

                 <div class="field">
                    <div class="label">
                        <label for="email">${_('Email')}:</label>
                    </div>
                    <div class="input">
                        ## we should be able to edit email !
                        ${h.text('email',class_="medium")}
                    </div>
                 </div>

                <div class="buttons">
                  ${h.submit('save',_('Save'),class_="ui-btn large")}
                  ${h.reset('reset',_('Reset'),class_="ui-btn large")}
                </div>
            </div>
        </div>
    ${h.end_form()}
    </div>
